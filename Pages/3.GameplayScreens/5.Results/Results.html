<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1, width=device-width" />

    <link rel="stylesheet" href="../../../global.css" />
    <link rel="stylesheet" href="./ResultsIndex.css" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400&display=swap"
    />
  </head>
  <body>
    <div class="foreground">
      <div class="headingText" id="Title">Results</div>
      <img class="hintIcon" id="hintIcon" src="../../../Assets/Info_alt_duotone.svg" />
      <button class="button1" id="submitUser">Register</button>
      <button class="button2" id="retryButton">Play Again</button>
      <button class="button3" id="chooseDifButton">Select Difficulty</button>
      <button class="button4" id="leaderButton">Leaderboards</button>
      <label class="boxLabel" for="text-Box" id="enterName">Enter Name:</label>
        <input class="textBox" type="text" id="textBox" name=""></input>
      <div class="final-score" id="final">Correct: #/5, Accuracy: ###%</div>
      <img class="home-icon" alt="" src="../../../Assets/Home-Icon.svg" id="home" />
      <div class="infoText" id="leaderboardText" style="display: none;"> Did your score make it to the top?
        Let's save it and find out!
      </div>
    </div>

    <script>
      console.log(localStorage.getItem('textSize'));
      var text_size;
      switch(localStorage.getItem('textSize')){
        case '1':
          text_size = 12 + 'px';
        break;
        
        case '2':
        text_size = 18 + 'px';
        break;
        
        case '3':
        text_size = 24 + 'px';
        break;
        
        default:
        text_size = 18 + 'px';
        break;
      }
      document.getElementById('submitUser').style.fontSize = text_size;
      document.getElementById('retryButton').style.fontSize = text_size;
      document.getElementById('chooseDifButton').style.fontSize = text_size;
      document.getElementById('leaderButton').style.fontSize = text_size;
    </script>

    <script>
      console.log(localStorage.getItem('fontType'));
      var font_type;
      switch(localStorage.getItem('fontType')){
        case '1':
          font_type = 'Novem'; 
        break;

        case '2':
          font_type = 'Times New Roman, serif';
        break;
      
        default:
          font_type = 'Novem'; 
        break;
      }

      document.getElementById('Title').style.fontFamily = font_type;
      document.getElementById('final').style.fontFamily = font_type;
      document.getElementById('leaderboardText').style.fontFamily = font_type;
      document.getElementById('enterName').style.fontFamily = font_type;
      document.getElementById('submitUser').style.fontFamily = font_type;
      document.getElementById('retryButton').style.fontFamily = font_type;
      document.getElementById('chooseDifButton').style.fontFamily = font_type;
      document.getElementById('leaderButton').style.fontFamily = font_type;
      
    </script>

    <script>


// Sorting function
function sortData(a, b) {
  // Sort by difficulty
  const difficultyOrder = { 'Hard': 0, 'Medium': 1, 'Easy': 2 };
  const difficultyComparison = difficultyOrder[a.Difficulty] - difficultyOrder[b.Difficulty];
  if (difficultyComparison !== 0) {
    return difficultyComparison;
  }

  // If difficulty is the same, sort by accuracy
  if (a.Accuracy !== b.Accuracy) {
    return b.Accuracy - a.Accuracy; // Higher accuracy comes first
  }

  // If difficulty and accuracy are the same, sort by correctness
  const correctnessComparison = b.Correct - a.Correct; // Higher correct values come first
  if (correctnessComparison !== 0) {
    return correctnessComparison;
  }

  // If all values are the same, sort by the original order in the array
  return 0;
}

      
      const guessCnt = localStorage.getItem('total-guesses');
      const corGuesses = localStorage.getItem('correct-guesses');
      const gameMode = localStorage.getItem('game-mode');
      let data = localStorage.getItem('myScores');

      if (!data) {
        const emptyArray = [];
        localStorage.setItem('myScores', JSON.stringify(emptyArray));
        data = emptyArray; // Set the variable to the newly created empty array
      } else {
  // Parse the string from localStorage back into an array
        data = JSON.parse(data);
      }
       
      document.getElementById("final").innerHTML = "Correct: " +
      corGuesses + "/5 <br /> Accuracy: " + (corGuesses/guessCnt * 100).toFixed(2) + "%<br /> Difficulty: " +
      gameMode;

      const hintIcon = document.getElementById("hintIcon");
        if (hintIcon) {
          hintIcon.addEventListener("mouseover", function (e) {
              document.getElementById("leaderboardText").style.display = 'block';
          });
          hintIcon.addEventListener("mouseout", function (e) {
              document.getElementById("leaderboardText").style.display = 'none';
          }); 
      }

      const regButton = document.getElementById("submitUser");
        if (submitUser) {
          submitUser.addEventListener("mouseover", function (e) {
              document.getElementById("leaderboardText").style.display = 'block';
          });
          submitUser.addEventListener("mouseout", function (e) {
              document.getElementById("leaderboardText").style.display = 'none';
          }); 

          submitUser.addEventListener("click", function (e) {
          data.push({Name: document.getElementById('textBox').value, 
          Difficulty: gameMode, Correct: corGuesses, Accuracy:(corGuesses/guessCnt * 100).toFixed(2)});
          const sortedData = data.sort(sortData);
          
          if (data.length > 10)
            data.pop();
            console.log(sortedData)
          localStorage.setItem('myScores', JSON.stringify(data));
          
          e.target.innerHTML = "Saved!"

          submitUser.disabled = true;
        });
        
      }
      
      var buttonContainer1 = document.getElementById("retryButton");
      if (buttonContainer1) {
        buttonContainer1.addEventListener("click", function (e) {
          if(gameMode == 'Easy'){
            window.location.href = '../2.Easy/EasyPage1.html';
          }else if (gameMode == 'Medium')
            window.location.href = '../3.Medium/MediumPage.html';
          else
            window.location.href = '../4.Hard/HardPage.html';
        });
      }
      
      var buttonContainer2 = document.getElementById("chooseDifButton");
      if (buttonContainer2) {
        buttonContainer2.addEventListener("click", function (e) {
            window.location.href = '../1.ChooseDif/Selection.html'
        });
      }
      
      var buttonContainer3 = document.getElementById("leaderButton");
      if (buttonContainer3) {
        buttonContainer3.addEventListener("click", function (e) {
            window.location.href = '../../4.LeaderboardPage/Leaderboard.html'
        });
      }
      
      var home = document.getElementById("home");
      if (home) {
        home.addEventListener("click", function (e) {
            window.location.href = '../../2.MainPage/MainScreen.html'
        });
      }
      </script>
  </body>
</html>
