<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="initial-scale=1, width=device-width" />

  <link rel="stylesheet" href="../../../global.css" />
  <link rel="stylesheet" href="./EasyIndex.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400&display=swap" />
</head>

<body>
    <div class="foreground">
      <div class="modeIndicator">
        <div class="buttonText" id="gamemode">Easy</div>
      </div>
      <div class="headingText" id="header">Song 1/5</div>
      <img class="hintIcon" id="hintIcon" src="../../../Assets/Info_alt_duotone.svg" />
      <button class="button1" id="option-1" value="1">Opt 1</button>
      <button class="button2" id="option-2" value="2">Opt 2</button>
      <button class="button3" id="option-3" value="3">Opt 3</button>
      <button class="button4" id="option-4" value="4">Opt 4</button>
      <div class="guessText" id="guessCount">Guesses Left: 3 Total: 0</div>
      <div class="infoText" id="hintPHolder" style="display: none;"> this is a placeholder for hints
        and to note that music is not yet implemeneted, for now see if you can guess the correct answer!
      </div>
      <img class="stop-and-play-duotone-icon" id="toggleMusic" alt="" src="../../../Assets/Stop_and_play_duotone.svg" />
      <img class="nextArrow" alt="" id="nextArr" src="../../../Assets/Right-Arrow.svg" hidden="" />
      
    </div>

    <script>
    var right_button;
      var bpm_ans;
      var correct_guesses = 0;
      var question_num = 1;
      var guessesLeft = 3;
      var numGuesses = 0;

      

      const audioElement = new Audio(`../../../Tracks/testAudio.mp3`);
      audioElement.value = 4;

      console.log(audioElement.value)
      /*function selectClip (): BPM
        will at random
      */

      /*function revealAns():
        - turns off all buttons before hand
        - searches through the buttons to see which buttons' option 
        string matches the correct answer
        -reveals the next question arrow
      */
      function revealAns(){
        var arr = [option_1, option_2,option_3,option_4]
        
        toggleButtons(true)

        var found = arr.find((element) => 
        document.getElementById(element.getAttribute('id')).innerHTML == bpm_ans);
        
        document.getElementById(found.getAttribute('id')).innerHTML = "This One!";
        document.getElementById("nextArr").removeAttribute("hidden");
        }


        /*function toggleButtons(t_f):void
        enables/disables all buttons at the same time*/
        function toggleButtons(t_f){
          option_1.disabled = t_f;
          option_2.disabled = t_f
          option_3.disabled = t_f;
          option_4.disabled = t_f;
        }

      /*function setCorrectAns(): void
        -randomly generates four answers, 3 being wrong and 1 being right
        -sets the correct answer based off what right_button equals
        -sets the other buttons to random answers between 60-144bpm

        **note - functionw will proabaly need to pass the buttons to use them
      */
     

      function setCorrectAns(){
        var arr = [option_1, option_2, option_3, option_4]

        right_button = Math.floor(Math.random() * 4) + 1;
        bpm_ans = 82

        var found = arr.find((element) => 
        document.getElementById(element.getAttribute('id')).value == right_button);
        document.getElementById(found.getAttribute('id')).innerHTML = bpm_ans;

        if(option_1 != found)
          document.getElementById("option-1").innerHTML = getRandomizedNum(bpm_ans);
  
        if(option_2 != found)
          document.getElementById("option-2").innerHTML = getRandomizedNum(bpm_ans);
        
        if(option_3 != found)
          document.getElementById("option-3").innerHTML = getRandomizedNum(bpm_ans);

        if(option_4 != found)
          document.getElementById("option-4").innerHTML = getRandomizedNum(bpm_ans);
        
        console.log(bpm_ans)
      }

      function getRandomizedNum(bpm_ans) {
        return Math.floor(Math.random() * (bpm_ans + 14 - (bpm_ans - 20) + 1) + (bpm_ans - 20));
      }

      /* function isCorrect(opt: optButton): void
        - takes in a button object and checks to see if it is correct
        - regardless of conditional, we inc numGuesses, and dec guessesLeft
        - if the button is correct, we set its text to "Correct" and reveal
        nextbutton
        - otherwise we set the text to "Wrong!", update the game stats display
          - if player has no guesses left, then revealAns is called
        - at the end, the button is disabled
      */

      function isCorrect(optButton){
        optButton.addEventListener("click", function (e) {
          numGuesses++;
          guessesLeft--;
          if(e.target.innerHTML == bpm_ans){
            toggleButtons(true);
            correct_guesses++;
            document.getElementById(optButton.getAttribute('id')).innerHTML = "Correct!";
            document.getElementById("nextArr").removeAttribute("hidden");
          }else{
            document.getElementById("guessCount").innerHTML = "Guesses Left: " + guessesLeft 
              + ' Total:' + numGuesses;
            optButton.innerHTML = "Wrong!";
            if (guessesLeft == 0)
              revealAns();

          }
          optButton.disabled = true; 
        });
      }
      /************************************************************************/

      const hintIcon = document.getElementById("hintIcon");
      const toggleMusic = document.getElementById("toggleMusic");
      const option_1 = document.getElementById("option-1");
      const option_2 = document.getElementById("option-2");
      const option_3 = document.getElementById("option-3");
      const option_4 = document.getElementById("option-4");
      const nextButton = document.getElementById("nextArr");

      setCorrectAns();

      
      if (hintIcon) {
        hintIcon.addEventListener("mouseover", function (e) {
            document.getElementById("hintPHolder").style.display = 'block';
        });
        hintIcon.addEventListener("mouseout", function (e) {
            document.getElementById("hintPHolder").style.display = 'none';
        }); 
      }


      if (toggleMusic) {
        toggleMusic.addEventListener("mouseover", function (e) {
            document.getElementById("hintPHolder").style.display = 'block';
        });

        toggleMusic.addEventListener("click", function(e){
          if(audioElement.paused == true){
            audioElement.play();
          }else{
              audioElement.pause();
          }
        });

        audioElement.addEventListener('ended', function(){
          audioElement.currentTime = 0;

          setTimeout(function() {
            audioElement.play();
          }, 1000);
        });

        toggleMusic.addEventListener("mouseout", function (e) {
            document.getElementById("hintPHolder").style.display = 'none';
        }); 
      }


      if (option_1)
        isCorrect(option_1);
      
      if (option_2)
        isCorrect(option_2);

      if (option_3)
        isCorrect(option_3);

      if (option_4)
        isCorrect(option_4);
      
      if (nextButton) {
        nextButton.addEventListener("click", function (e) {
          if (question_num + 1 > 5){
           
            localStorage.setItem('total-guesses', numGuesses);
            localStorage.setItem('correct-guesses', correct_guesses);
            localStorage.setItem('game-mode', document.getElementById('gamemode').innerHTML)
            window.location.href = '../5.Results/Results.html'
          
          } else {
            
            setCorrectAns();
            toggleButtons(false);
            question_num++;
            guessesLeft = 3;
            
            document.getElementById("guessCount").innerHTML ="Guesses Left: " + guessesLeft 
            + ' Total:' + numGuesses + " Correct: " + correct_guesses;
            document.getElementById("header").innerHTML = "Song " + question_num + "/5";
            document.getElementById("nextArr").setAttribute("hidden", "hidden");
          }
        });
      }
    </script>
</body>

</html>